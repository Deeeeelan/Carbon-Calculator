<!DOCTYPE html>
<!--CE stands for Carbon Emissions-->

<html lang="en"></html>
<head>
    <!--web page title-->
    <title style="color:black;"> 
        Carbon Calculator
    </title>
    <link rel="stylesheet" href="style.css"> <!--Creates a stylesheet from style.css in order to format each element on the page-->
</head>
<body></body>
    <h1>Carbon Emissions Calculator</h1> <!--main central title within the page-->    
    <div class="center"> <!--creates a centered white box for the information within-->
        <h2>About</h2> <!--subheading-->

        <!--Creates several green buttons that will show more information about each topic on click-->
        <!--Carbon emissions-->
        <button class="dropdown" onclick="displayInfo('carbonEmissions')"> <!--When the button is clicked, it calls the displayInfo() function from map.js using the id of is related information (carbonEmissions)-->
            What are carbon emissions?
        </button> 
        <div id="carbonEmissions" class="info"> <!--Uses the same id used when the function is called-->
            Carbon emissions are the release of compounds containing carbon into the atmosphere created by industrial processes, which include burning fossil fuels. Fossil fuels are used to generate electricity and power vehicles.
        </div>

        <!--Harm of carbon compounds-->
        <button class="dropdown" onclick="displayInfo('harmful')"> <!--unique id for each button-->
            Why are carbon compounds harmful?
        </button> 
        <div id="harmful" class="info">
            These compounds trap heat in the atmosphere, leading to global warming and climate change as Earth's temperatures increase. This leads to shrinking ice caps, rising ocean levels, warmer temperatures, and air pollution, all of which harms the environment.
        </div>        
        
        <!--Why this matters-->
        <button class="dropdown" onclick="displayInfo('issue')">
            Why should we care?
        </button> 
        <div id="issue" class="info">
            As high-income countries grow, their carbon footprint grows along with it, increasing the amount of carbon emissions emitted per person. According to the World Bank, the average person in the United States, emits <b>13.83 tons</b> of carbon per year, almost <b>3 times</b> the global average. Large amounts of carbon emissions leads to global warming, destroying habitats and animals.
        </div>

        <!--Methods to reduce carbon emissions-->
        <button class="dropdown" onclick="displayInfo('method')">
            How can we reduce our carbon emissions?
        </button> 
        <div id="method" class="info">
            Transportation methods account for <b>15%</b> of the world's carbon emissions. By reducing our reliance on motorized vehicles, we can reduce our consumption of fossil fuels and our carbon footprint. Instead of driving to the nearby park, you can help the planet by walking or biking instead. Using electric vehicles or renewable energy sources, such as solar power, can also help reduce carbon emissions.
        </div>

        <!--Purpose of calculator-->
        <button class="dropdown" onclick="displayInfo('purpose')">
            What is the purpose of the calculator?
        </button> 
        <div id="purpose" class="info">
            This carbon emission calculator tells you how many carbon emissions you release using either a car, plane, or train based on how many miles you traveled. It helps you become more aware of your impact on the environment, and what changes you can make to decrease your carbon footprint.
        </div>    
               
        <!--How the calculator works-->
        <button class="dropdown" onclick="displayInfo('work')">
            How does the calculator work?
        </button> 
        <div id="work" class="info">
            The calculations are based on the average carbon emissions of each mode of transport. Cars emit 400 g CO<sub>2</sub>/mi<!--US Environmental Protection Agency-->, trucks emit 1,617 g CO<sub>2</sub>/mi<!--Global Supply Chain-->, planes emit 24,176 g CO<sub>2</sub>/mi, and trains emit 177 g CO<sub>2</sub>/mi. 
        </div>

        <!--<div id="map"; style="height: 500px; width: 75%;"></div>-->
        <div class="calculatorbox"> <!--creates a separate green box for the calculator-->
            <h2 style="text-align: center">
                Calculate your carbon emissions
            </h2>
            
            <!--dropdown box and text boxes-->
            <div>
                <input type="number" id="miles" min=0 value=0> <!--a text input box used to input the miles traveled-->
                <p id="travel" style="color:darkgreen">miles traveled by</p>
                
                <select name = "vehicle" id = "vehicle"> <!--dropdown menu with 4 options: car, truck, plane, and train-->
                    <option value = "car"> car </option>
                    <option value = "truck"> truck </option>
                    <option value = "plane"> plane </option>
                    <option value = "train"> train </option>
                </select>

                <button id="calculateEM" class="CEsubmit" onclick="calculateCE()">Calculate!</button> <!--button used to calculate carbon emissions based on the provided inputs, runs calculateCE() on click-->
            </div>
            <!--output area-->
            <div id="output" class="output">
            </div>
        </div>
    <br>
    
    <div id="map"></div>

    <div id="container">
        <div id="map"></div>
        <div id="sidebar">
          <h3 style="flex-grow: 0">Request</h3>
          <pre style="flex-grow: 1" id="request"></pre>
          <h3 style="flex-grow: 0">Response</h3>
          <pre style="flex-grow: 1" id="response"></pre>
        </div>
      </div>
      <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBBZPpkIxfgQUQzAcw_76dqLp8HDvy1hyQ&callback=initMap&v=weekly&solution_channel=GMP_CCS_distancematrix_v2"
        defer
      ></script>
    <script>
        
        function initMap() {
        const bounds = new google.maps.LatLngBounds();
        const markersArray = [];
        
        const map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: 55.53, lng: 9.4 },
            zoom: 10,
        });

        // initialize services
        const geocoder = new google.maps.Geocoder();
        const service = new google.maps.DistanceMatrixService();
        // build request
        const origin1 = { lat: 55.93, lng: -3.118 };
        const origin2 = "Greenwich, England";
        const destinationA = "Stockholm, Sweden";
        const destinationB = { lat: 50.087, lng: 14.421 };
        const request = {
            origins: [origin1, origin2],
            destinations: [destinationA, destinationB],
            travelMode: google.maps.TravelMode.DRIVING,
            unitSystem: google.maps.UnitSystem.METRIC,
            avoidHighways: false,
            avoidTolls: false,
        };

        // put request on page
        document.getElementById("request").innerText = JSON.stringify(
            request,
            null,
            2,
        );
        // get distance matrix response
        service.getDistanceMatrix(request).then((response) => {
            // put response
            document.getElementById("response").innerText = JSON.stringify(
            response,
            null,
            2,
            );

            // show on map
            const originList = response.originAddresses;
            const destinationList = response.destinationAddresses;

            deleteMarkers(markersArray);

            const showGeocodedAddressOnMap = (asDestination) => {
            const handler = ({ results }) => {
                map.fitBounds(bounds.extend(results[0].geometry.location));
                markersArray.push(
                new google.maps.Marker({
                    map,
                    position: results[0].geometry.location,
                    label: asDestination ? "D" : "O",
                }),
                );
            };
            return handler;
            };

            for (let i = 0; i < originList.length; i++) {
            const results = response.rows[i].elements;

            geocoder
                .geocode({ address: originList[i] })
                .then(showGeocodedAddressOnMap(false));

            for (let j = 0; j < results.length; j++) {
                geocoder
                .geocode({ address: destinationList[j] })
                .then(showGeocodedAddressOnMap(true));
            }
            }
        });
        }

        function deleteMarkers(markersArray) {
        for (let i = 0; i < markersArray.length; i++) {
            markersArray[i].setMap(null);
        }

        markersArray = [];
        }

        window.initMap = initMap;

    </script>
    
    <br>
    <div class="funfactsinfo">
        <h2 style="font-size: 40px">
            Some (fun) facts:
        </h2>

        <!--All of the fun facts are changed in calculateCE() based on output-->
        <div>
            It would take
            <p class="funfacts">
                <!--See calculateCE()--> [amount of trees]
            </p>
            to convert all of that carbon dioxide into oxygen in<style="font-size:30px"> 1 year </style>
        </div>
        <div>
            If all 8 billion people in the world travelled that distance, it would contribute
            <div class="funfacts">
                <!--See calculateCE()--> [CO2 emissions in tons]
            </div>
            US tons of carbon dioxide <br> That's 
            <div class="funfacts">
                <!--See calculateCE()--> [CO2 emissions in tons]
            </div>
            of the total amount of carbon emissions in 2024
        </div>
    </div>
    <script src = "carboncalculator.js"></script> <!--retrieves the JavaScript code at map.js for use by the HTML code-->
    </div>
    
    <button id="test">test</button>
    <script>
        document.getElementById("test").addEventListener("click", function(){
            fetch('http://127.0.0.1:5001/map')
            .then(data => {
                alert(data)
                console.log(data)
            })
            
        });
        
    </script>
    <img src="images/forest.jpg" alt="Forest background">
    </img>
</body>